(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Chat"],{"498a":function(t,e,o){"use strict";var n=o("23e7"),i=o("58a8").trim,s=o("c8d2");n({target:"String",proto:!0,forced:s("trim")},{trim:function(){return i(this)}})},"5a96":function(t,e,o){"use strict";o.r(e);o("fb6a"),o("498a");var n=o("7a23"),i=function(t){return Object(n["pushScopeId"])("data-v-59f8c2ef"),t=t(),Object(n["popScopeId"])(),t},s={class:"chat-container"},r={class:"right"},a={class:"chat-name"},c={key:0,class:"icon-svg icon-renzheng",style:{"margin-left":"0.1rem"},"aria-hidden":"true"},l=i((function(){return Object(n["createElementVNode"])("use",{"xlink:href":"#icon-renzheng"},null,-1)})),u=[l],d={class:"chat-dec"},h=i((function(){return Object(n["createElementVNode"])("i",{class:"iconfont icon-set"},null,-1)})),g={class:"chat-content"},p=i((function(){return Object(n["createElementVNode"])("li",{class:"scroll-bottom"},null,-1)})),m={class:"van-safe-area-bottom van-hairline--top chat-bottom"},f={class:"reply-container van-hairline--bottom"},v=i((function(){return Object(n["createElementVNode"])("i",{class:"iconfont icon-reply"},null,-1)})),b={class:"reply-content"},O={class:"top"},j={class:"bottom van-ellipsis"},M={class:"chat-bottom-textarea"},y={key:0,class:"group-b"},$={key:1,class:"group-b"},C={key:2,class:"group-b"},k={key:3,class:"group-b"},_={key:4,class:"group-b"},I={key:5,style:{display:"flex",flex:"1"}},w=i((function(){return Object(n["createElementVNode"])("use",{"xlink:href":"#icon-send"},null,-1)})),T=[w],S=i((function(){return Object(n["createElementVNode"])("i",{class:"iconfont icon-lightning"},null,-1)}));function V(t,e,i,l,w,V){var N,B,E,G,L,x,H,D,P,R,F,A,U,z,Y,J,q=Object(n["resolveComponent"])("van-image"),K=Object(n["resolveComponent"])("van-nav-bar"),W=Object(n["resolveComponent"])("chat-notice"),Q=Object(n["resolveComponent"])("ChatItem"),X=Object(n["resolveComponent"])("van-list"),Z=Object(n["resolveComponent"])("van-icon"),tt=Object(n["resolveComponent"])("router-link"),et=Object(n["resolveComponent"])("van-field"),ot=Object(n["resolveComponent"])("van-button"),nt=Object(n["resolveComponent"])("van-count-down");return Object(n["openBlock"])(),Object(n["createElementBlock"])(n["Fragment"],null,[Object(n["createElementVNode"])("section",s,[Object(n["createVNode"])(K,{"left-text":"","left-arrow":"",onClickLeft:V.back,fixed:"",placeholder:"","safe-area-inset-top":"","z-index":"2",onClickRight:e[1]||(e[1]=function(e){return t.$router.push({name:"ChatSet",params:{id:V.groupId}})})},{title:Object(n["withCtx"])((function(){var i,s,l,h;return[Object(n["createElementVNode"])("div",{class:"chat-title",onClick:e[0]||(e[0]=Object(n["withModifiers"])((function(e){return t.$router.push({name:"ChatSet",params:{id:V.groupId}})}),["stop"]))},[(Object(n["openBlock"])(),Object(n["createBlock"])(q,{key:V.groupInfo.id,round:"",width:"0.5rem",height:"0.5rem","icon-size":"0.5rem","lazy-load":"","show-loading":"",src:(null===(i=V.groupInfo)||void 0===i?void 0:i.image)||t.$f.formatIcon(V.groupId),"error-icon":o("aecc")},null,8,["src","error-icon"])),Object(n["createElementVNode"])("div",r,[Object(n["createElementVNode"])("div",a,[Object(n["createTextVNode"])(Object(n["toDisplayString"])((null===(s=V.groupInfo)||void 0===s?void 0:s.nickname)||"")+" ",1),null!==(l=V.groupInfo)&&void 0!==l&&l.provider_count&&(null===(h=V.groupInfo)||void 0===h?void 0:h.provider_count)>0?(Object(n["openBlock"])(),Object(n["createElementBlock"])("svg",c,u)):Object(n["createCommentVNode"])("",!0)]),Object(n["createElementVNode"])("div",d,Object(n["toDisplayString"])(V.total)+" "+Object(n["toDisplayString"])(t.$t("members")),1)])])]})),right:Object(n["withCtx"])((function(){return[h]})),_:1},8,["onClickLeft"]),Object(n["createVNode"])(W,{content:w.activePinMsg.content},null,8,["content"]),Object(n["createVNode"])(X,{loading:w.loading,"onUpdate:loading":e[2]||(e[2]=function(t){return w.loading=t}),finished:w.finished,error:w.error,"onUpdate:error":e[3]||(e[3]=function(t){return w.error=t}),offset:"200","error-text":t.$t("errorText"),onLoad:V.onLoad,direction:"up","loading-text":t.$t("loading"),"finished-text":t.$t("hasReachedTop")},{default:Object(n["withCtx"])((function(){return[Object(n["createElementVNode"])("ul",g,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(w.chatGroupHistoryMsg,(function(t,e){return Object(n["openBlock"])(),Object(n["createBlock"])(Q,{key:t.id,source:t,index:e,listLoading:w.loading,loading:!!w.sendLoading[null===t||void 0===t?void 0:t.id],error:!!w.sendError[null===t||void 0===t?void 0:t.id],showDate:V.isShowDate(t,e),onOnRemove:function(t){return V.handleRemove(e)},onOnRemoveUser:V.handleRemoveUser,onOnReply:V.handleReply,onOnReSend:V.reSendMessage,onOnRefreshPin:w.getPinMsgLoading,onOnLogin:V.login,onOnModifyChatGroupHistoryMsg:V.onModifyChatGroupHistoryMsg},null,8,["source","index","listLoading","loading","error","showDate","onOnRemove","onOnRemoveUser","onOnReply","onOnReSend","onOnRefreshPin","onOnLogin","onOnModifyChatGroupHistoryMsg"])})),128)),p])]})),_:1},8,["loading","finished","error","error-text","onLoad","loading-text","finished-text"]),Object(n["createElementVNode"])("div",m,[Object(n["withDirectives"])(Object(n["createElementVNode"])("div",f,[v,Object(n["createElementVNode"])("div",b,[Object(n["createElementVNode"])("div",O,Object(n["toDisplayString"])(t.$t("reply"))+" "+Object(n["toDisplayString"])(w.replyMsg.user_nickname||((null===(N=w.replyMsg)||void 0===N||null===(B=N.user_address)||void 0===B||null===(E=B.slice)||void 0===E?void 0:E.call(B,0,4))||"")+"..."+((null===(G=w.replyMsg)||void 0===G||null===(L=G.user_address)||void 0===L||null===(x=L.slice)||void 0===x?void 0:x.call(L,-4))||"")),1),Object(n["createElementVNode"])("div",j,Object(n["toDisplayString"])((null===(H=w.replyMsg)||void 0===H?void 0:H.content)||""),1)]),Object(n["createVNode"])(Z,{name:"cross",size:"0.44rem",color:"#3F80F7",onClick:e[4]||(e[4]=Object(n["withModifiers"])((function(t){return w.replyMsg={}}),["stop"]))})],512),[[n["vShow"],w.replyMsg.id]]),Object(n["createElementVNode"])("div",M,[2===V.groupInfo.status&&V.role<1&&V.chatToken?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",y,[Object(n["createElementVNode"])("span",null,Object(n["toDisplayString"])(t.$t("violationBan")),1),Object(n["createVNode"])(tt,{to:{name:"ChatPenaltyInfo",params:{id:V.groupId}}},{default:Object(n["withCtx"])((function(){return[Object(n["createTextVNode"])(Object(n["toDisplayString"])(t.$t("unban")),1)]})),_:1},8,["to"])])):5===(null===(D=t.$store.state.chat)||void 0===D?void 0:D.userInfo.status)&&V.chatToken?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",$,[Object(n["createElementVNode"])("span",null,Object(n["toDisplayString"])(t.$t("kickOutAllGroup")),1)])):5===V.groupMemberInfo.status&&V.chatToken?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",C,[Object(n["createElementVNode"])("span",null,Object(n["toDisplayString"])(t.$t("kickOutGroup")),1)])):2===V.groupMemberInfo.status&&V.chatToken?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",k,[Object(n["createElementVNode"])("span",null,Object(n["toDisplayString"])(t.$t("permanentBanRecommend")),1)])):1===V.groupMemberInfo.status&&V.chatToken?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",_,[Object(n["createElementVNode"])("span",null,Object(n["toDisplayString"])(t.$t("banned"))+Object(n["toDisplayString"])(t.$f.formatDate(V.groupMemberInfo.banned_expired_time))+" "+Object(n["toDisplayString"])(t.$t("unban1")),1)])):V.chatToken&&null!==(P=V.groupMemberInfo)&&void 0!==P&&P.group_id&&1!==(null===(R=V.groupMemberInfo)||void 0===R?void 0:R.is_leave)?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",I,[Object(n["createVNode"])(q,{class:"icon-svg icon-red-packet",src:o("c1f5"),onClick:V.create},null,8,["src","onClick"]),Object(n["createVNode"])(et,{ref:"inputMessage",class:"chat-bottom-input",style:{height:"auto"},modelValue:w.message,"onUpdate:modelValue":e[5]||(e[5]=function(t){return w.message=t}),modelModifiers:{trim:!0},rows:"1",autosize:"",maxlength:"300",label:"",type:"textarea",clearable:"",placeholder:t.$t("enterMessage")+V.priceMsg},null,8,["modelValue","placeholder"])])):null!==(F=t.$store.state)&&void 0!==F&&null!==(A=F.chat)&&void 0!==A&&null!==(U=A.groupMemberInfo)&&void 0!==U&&U.group_id&&1!==(null===(z=t.$store.state)||void 0===z||null===(Y=z.chat)||void 0===Y||null===(J=Y.groupMemberInfo)||void 0===J?void 0:J.is_leave)||!V.chatToken?(Object(n["openBlock"])(),Object(n["createBlock"])(et,{key:7,class:"chat-bottom-input readonly",modelValue:w.message,"onUpdate:modelValue":e[6]||(e[6]=function(t){return w.message=t}),rows:"1",autosize:"",label:"",type:"textarea",clearable:"",readonly:"",placeholder:t.$t("pleaseLoginToSendMessagesInGroup"),onClick:Object(n["withModifiers"])(V.login,["stop"])},null,8,["modelValue","placeholder","onClick"])):(Object(n["openBlock"])(),Object(n["createBlock"])(ot,{key:6,round:"",plain:"",block:"",type:"primary",size:"small",style:{height:"0.68rem"},onClick:Object(n["withModifiers"])(V.joinChatGroup,["stop"]),loading:w.joinLoading,disabled:t.$store.state.chat.initChatLoading},{default:Object(n["withCtx"])((function(){return[Object(n["createTextVNode"])(Object(n["toDisplayString"])(t.$t("joinGroupChat")),1)]})),_:1},8,["onClick","loading","disabled"])),3===V.groupInfo.status&&!w.isFinish&&V.role<1&&""!==V.role?(Object(n["openBlock"])(),Object(n["createBlock"])(nt,{key:8,class:"count-down",onFinish:e[7]||(e[7]=function(t){return w.isFinish=!0}),ref:"countDown",time:w.time,format:"mm:ss"},null,8,["time"])):Object(n["createCommentVNode"])("",!0),Object(n["withDirectives"])((Object(n["openBlock"])(),Object(n["createElementBlock"])("svg",{class:"icon-svg icon-send","aria-hidden":"true",onClick:e[8]||(e[8]=Object(n["withModifiers"])((function(){return V.sendChatMsg&&V.sendChatMsg.apply(V,arguments)}),["stop"]))},T,512)),[[n["vShow"],(3===V.groupInfo.status&&(w.isFinish||V.role>=1)||3!==V.groupInfo.status)&&w.message.trim()]])])])]),V.role>1&&2!==V.groupInfo.status&&3!==V.groupInfo.status?(Object(n["openBlock"])(),Object(n["createBlock"])(tt,{key:0,class:"punish-btn",to:{name:"ChatPenalty",params:{id:V.groupId}}},{default:Object(n["withCtx"])((function(){return[S]})),_:1},8,["to"])):Object(n["createCommentVNode"])("",!0)],64)}var N=o("2909"),B=o("5530"),E=(o("ac1f"),o("00b4"),o("caad"),o("2532"),o("4de4"),o("d3b7"),o("c740"),o("a434"),o("b0c0"),o("d81d"),o("99af"),o("5319"),o("e9c4"),o("365c")),G=function(t){return Object(n["pushScopeId"])("data-v-17ca1e62"),t=t(),Object(n["popScopeId"])(),t},L=G((function(){return Object(n["createElementVNode"])("i",{class:"iconfont icon-notice"},null,-1)})),x={class:"chat-notice-content"},H={class:"content van-ellipsis"},D={key:1,class:"notice-placeholder"},P={class:"notice-content"};function R(t,e,o,i,s,r){var a=Object(n["resolveComponent"])("van-icon"),c=Object(n["resolveComponent"])("van-dialog");return Object(n["openBlock"])(),Object(n["createElementBlock"])(n["Fragment"],null,[s.noticeVisible?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:0,class:"chat-notice",onClick:e[1]||(e[1]=Object(n["withModifiers"])((function(){return r.goTopList&&r.goTopList.apply(r,arguments)}),["stop"]))},[L,Object(n["createElementVNode"])("div",x,[Object(n["createElementVNode"])("div",H,Object(n["toDisplayString"])(o.content||t.$t("chatPrincipleContent")),1)]),Object(n["createVNode"])(a,{class:"icon-close",name:"cross",size:"0.44rem",color:"#C8C9CC",onClick:e[0]||(e[0]=Object(n["withModifiers"])((function(t){return s.noticeVisible=!1}),["stop"]))})])):Object(n["createCommentVNode"])("",!0),s.noticeVisible?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",D)):Object(n["createCommentVNode"])("",!0),Object(n["createVNode"])(c,{show:s.show,"onUpdate:show":e[3]||(e[3]=function(t){return s.show=t}),showConfirmButton:"",confirmButtonColor:"#3F80F7"},{title:Object(n["withCtx"])((function(){return[Object(n["createTextVNode"])(Object(n["toDisplayString"])(t.$t("chatConvention"))+" ",1),Object(n["createVNode"])(a,{class:"icon-dialog-close",name:"close",color:"#C8C9CC",size:"0.44rem",onClick:e[2]||(e[2]=Object(n["withModifiers"])((function(t){return s.show=!1}),["stop"]))})]})),default:Object(n["withCtx"])((function(){return[Object(n["createElementVNode"])("div",P,Object(n["toDisplayString"])(t.$t("chatPrincipleContent")),1)]})),_:1},8,["show"])],64)}var F={name:"ChatNotice",props:{content:{type:String,default:""}},data:function(){return{noticeVisible:!0,show:!1,notice:""}},methods:{goTopList:function(){this.content?this.$router.push({name:"ChatTop",params:{id:this.$route.params.id}}):this.show=!0}}},A=(o("a5b8"),o("6b0d")),U=o.n(A);const z=U()(F,[["render",R],["__scopeId","data-v-17ca1e62"]]);var Y=z,J=o("fa7d"),q=o("335a"),K="undefined"!==typeof window;function W(t){let e;Object(n["onMounted"])(()=>{t(),Object(n["nextTick"])(()=>{e=!0})}),Object(n["onActivated"])(()=>{e&&t()})}function Q(t,e,o={}){if(!K)return;const{target:i=window,passive:s=!1,capture:r=!1}=o;let a;const c=o=>{const i=Object(n["unref"])(o);i&&!a&&(i.addEventListener(t,e,{capture:r,passive:s}),a=!0)},l=o=>{const i=Object(n["unref"])(o);i&&a&&(i.removeEventListener(t,e,r),a=!1)};Object(n["onUnmounted"])(()=>l(i)),Object(n["onDeactivated"])(()=>l(i)),W(()=>c(i)),Object(n["isRef"])(i)&&Object(n["watch"])(i,(t,e)=>{l(e),c(t)})}K&&window;Symbol("van-field");var X=o("de8e"),Z=o("c9d9"),tt={name:"Chat",components:{ChatNotice:Y,ChatItem:X["a"]},setup:function(){function t(){Object(n["nextTick"])((function(){setTimeout((function(){var t,e=document.querySelector(".scroll-bottom");null===e||void 0===e||null===(t=e.scrollIntoView)||void 0===t||t.call(e,!0)}),10)}))}var e=window.navigator.userAgent.toLocaleLowerCase(),o=/iphone|ipad|ipod/.test(e),i=/android/.test(e);i?Q("resize",t):o&&Q("focusout",t,{target:document.body})},data:function(){return{message:"",isLogin:""!==this.$store.state.currentAccount||!1,noticeVisible:!0,chatGroupHistoryMsg:[],count:7,loading:!1,finished:!1,error:!1,scrollChatId:"",joinLoading:!1,user:{ave_points:0,jf:0},showPopover:{},timer:null,time:3e4,isFinish:!0,isTip:q["a"].get("grabAdmin",[]).includes(this.$store.state.chat.groupId)||!1,isInit:!0,sendLoading:{},sendError:{},sendMessageLoading:!1,timerMsg:null,msgCaches:[],TimerSaveMsgTime:null,replyMsg:{},activePinMsg:{},getPinMsgLoading:!1}},computed:{chatToken:function(){var t,e;return(null===(t=this.$store.state)||void 0===t||null===(e=t.chat)||void 0===e?void 0:e.chatToken)||""},groupInfo:function(){var t,e;return(null===(t=this.$store.state)||void 0===t||null===(e=t.chat)||void 0===e?void 0:e.groupInfo)||{id:"",name:"",nickname:""}},groupMemberInfo:function(){var t,e;return(null===(t=this.$store.state)||void 0===t||null===(e=t.chat)||void 0===e?void 0:e.groupMemberInfo)||{}},memberCount:function(){var t,e;return null===(t=this.$store.state)||void 0===t||null===(e=t.chat)||void 0===e?void 0:e.memberCount},online:function(){var t;return(null===(t=this.groupInfo)||void 0===t?void 0:t.online_members)||0},total:function(){var t;return(null===(t=this.groupInfo)||void 0===t?void 0:t.total_members)||0},startId:function(){var t,e;return(null===(t=this.chatGroupHistoryMsg)||void 0===t||null===(e=t[0])||void 0===e?void 0:e.id)||""},role:function(){if(""===this.$store.state.chat.groupMemberInfo.role||""===this.$store.state.chat.groupMemberInfo.user_role)return"";var t=2===this.$store.state.chat.groupMemberInfo.role?1.5:this.$store.state.chat.groupMemberInfo.role,e=Math.max(t,this.$store.state.chat.groupMemberInfo.user_role);return e},groupId:function(){return this.$store.state.chat.groupId},price:function(){return this.$store.state.chat.price||0},priceChange:function(){return this.$store.state.chat.priceChange||0},priceMsg:function(){if(!this.price||!this.priceChange)return"";var t=this.priceChange>0?"+".concat(this.priceChange,"%"):"".concat(this.priceChange,"%");return"  |  $"+this.$f.formatNumber2(this.price)+"  "+t}},watch:{"$store.state.ws.chatMsg":function(t){var e,o=this;if(t.group_id===this.$store.state.chat.groupId)if("groupmember_control"!==t.action&&"user_control"!==t.action){if("group_member_status"===t.action)return this.$store.state.chat.memberCount.online_members=t.online,this.$store.state.chat.memberCount.total_members=t.total,this.$store.state.chat.groupInfo.online_members=t.online,void(this.$store.state.chat.groupInfo.total_members=t.total);if("price"===t.action)return this.$store.state.chat.price=t.price,void(this.$store.state.chat.priceChange=t.price_change);if("delete_msg"===t.action){var n=this.chatGroupHistoryMsg.findIndex((function(e){return e.id===t.id}));return n>-1&&(this.chatGroupHistoryMsg.splice(n,1),this.getPinMsg()),void(t.online&&(this.$store.state.chat.memberCount.online_members=t.online,this.$store.state.chat.groupInfo.online_members=t.online))}if("group_control"!==t.action){if("pin_msg"!==t.action){if("unpin_msg"===t.action){var i=this.chatGroupHistoryMsg.findIndex((function(e){return e.id===t.id}));return i>-1&&(this.chatGroupHistoryMsg[i].is_pined=0),void this.getPinMsg()}if(t.online&&(this.$store.state.chat.memberCount.online_members=t.online,this.$store.state.chat.groupInfo.online_members=t.online),(null===(e=this.chatGroupHistoryMsg)||void 0===e?void 0:e.length)>0){var s,r=null===(s=this.$store.state.chat)||void 0===s?void 0:s.userInfo;if(r.address===t.user_address&&r.chain===t.user_chain&&this.sendMessageLoading)return;var a=this.chatGroupHistoryMsg.findIndex((function(e){return e.id===t.id}));if(a>-1)this.chatGroupHistoryMsg.splice(a,1,Object(B["a"])(Object(B["a"])({},t),{},{image:t.user_image,nickname:t.user_nickname,to_msg:t.to_msg?JSON.parse(t.to_msg):""}));else{var c=this.chatGroupHistoryMsg[this.chatGroupHistoryMsg.length-1];if((null===t||void 0===t?void 0:t.created_time)>(null===c||void 0===c?void 0:c.created_time)){var l=Object(B["a"])(Object(B["a"])({},t),{},{image:t.user_image,nickname:t.user_nickname,to_msg:t.to_msg?JSON.parse(t.to_msg):""});this.msgCaches.push(l),this.timerMsg||(this.timerMsg=setTimeout((function(){var t;(t=o.chatGroupHistoryMsg).push.apply(t,Object(N["a"])(o.msgCaches)),o.msgCaches=[],o.timerMsg=null,o.scrollBottom()}),1e3)),null!==t&&void 0!==t&&t.created_time&&this.saveLastMsgTime(null===t||void 0===t?void 0:t.created_time)}}}else this.chatGroupHistoryMsg.push(t),this.scrollBottom(),null!==t&&void 0!==t&&t.created_time&&this.saveLastMsgTime(null===t||void 0===t?void 0:t.created_time)}else if(t.msg){var u=this.chatGroupHistoryMsg.findIndex((function(e){return e.id===t.id}));u>-1&&(this.chatGroupHistoryMsg[u].is_pined=1),this.getPinMsg()}}else this.$store.state.chat.groupInfo.status=t.status}else if(5===t.status){var d;this.chatGroupHistoryMsg=this.chatGroupHistoryMsg.filter((function(e){return!(e.user_address===t.user_address&&e.user_chain===t.user_chain)}));var h=null===(d=this.$store.state.chat)||void 0===d?void 0:d.userInfo;h.address===t.user_address&&h.chain===t.user_chain&&this.$store.dispatch("getChatGroupMemberInfo",this.groupId)}},"$store.state.ws.isConnected":function(t){t&&this.subChatMsg()},"$store.state.currentAccount":function(t){t&&"Chat"===this.$route.name&&t!==localStorage.currentAccount&&Object(J["a"])()},"$store.state.chat.chatToken":function(t){t&&this.subChatMsg()},"$store.state.chat.groupInfo.manager_count":function(t){var e;void 0!==t&&t<5&&0===this.role&&!this.isTip&&this.chatToken&&null!==(e=this.groupMemberInfo)&&void 0!==e&&e.group_id&&this.alertTips()},role:function(t){var e=this.$store.state.chat.groupInfo.manager_count;0===t&&void 0!==e&&e<5&&!this.isTip&&this.alertTips()},"$store.state.chat.groupMemberInfo.group_id":function(){this.alertTips()},"$store.state.chat.userInfo":function(){this.initSlowMode()},groupId:function(t){t&&(this.chatGroupHistoryMsg=[],this.$store.state.chat.price=0,this.$store.state.chat.priceChange=0,this.init(),this.getPinMsg())}},created:function(){document.removeEventListener("visibilitychange",this.bindVisible),document.addEventListener("visibilitychange",this.bindVisible)},mounted:function(){this.subChatMsg(),this.getPinMsg()},methods:{init:function(){this.isInit=!0,this.finished=!1,this.error=!1,this.loading||this.getChatGroupHistoryMsg(-1),this.subChatMsg(),this.$store.dispatch("subChatToken")},bindVisible:function(){"visible"===document.visibilityState&&this.init()},getChatGroupHistoryMsg:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startId;this.groupId&&(this.loading=!0,Object(E["K"])(this.groupId,this.count,e).then((function(e){var o;t.finished=e.length<t.count,e=e.map((function(t){var e=Object(B["a"])({},t);return null!==t&&void 0!==t&&t.to_msg&&(e.to_msg=JSON.parse(t.to_msg)),e}));var n,i,s,r,a,c=0,l=0;(null!==(o=t.chatGroupHistoryMsg)&&void 0!==o&&o[0]&&(c=document.body.scrollHeight,l=document.documentElement.scrollTop||window.pageYOffset),t.isInit)?(t.chatGroupHistoryMsg=e,(null===(n=e)||void 0===n?void 0:n.length)>0&&null!==(i=e)&&void 0!==i&&null!==(s=i[e.length-1])&&void 0!==s&&s.created_time&&t.saveLastMsgTime(null===(r=e)||void 0===r||null===(a=r[e.length-1])||void 0===a?void 0:a.created_time)):t.chatGroupHistoryMsg=e.concat(t.chatGroupHistoryMsg);t.$nextTick((function(){if(t.isInit)t.isInit=!1,t.scrollBottom(!0);else{var e=document.body.scrollHeight;document.scrollingElement.scrollTop=e-c+l}}))})).catch((function(){t.error=!0})).finally((function(){setTimeout((function(){t.loading=!1}),1e3)})))},onLoad:function(){this.getChatGroupHistoryMsg()},sendChatMsg:function(){var t,e,o,n,i=this;if(null===(t=this.$refs)||void 0===t||null===(e=t.inputMessage)||void 0===e||null===(o=e.focus)||void 0===o||o.call(e),this.message){var s={group_id:this.groupId,content:this.message,to_id:this.replyMsg.id||0,type:1};this.sendMessageLoading=!0;var r=parseInt(Date.now()/1e3),a="send-".concat(r);this.sendLoading[a]=!0;var c=(null===(n=this.$store.state.chat)||void 0===n?void 0:n.userInfo)||{};this.chatGroupHistoryMsg.push({id:a,created_time:r,group_id:this.groupId,type:1,is_pined:0,content:this.message,user_image:(null===c||void 0===c?void 0:c.image)||"",nickname:(null===c||void 0===c?void 0:c.nickname)||"",user_address:(null===c||void 0===c?void 0:c.address)||"",user_chain:(null===c||void 0===c?void 0:c.chain)||"",user_role:this.groupMemberInfo.user_role||0,member_role:this.groupMemberInfo.role||0,to_msg:this.replyMsg.id?this.replyMsg:""}),this.scrollBottom(),this.message="",this.replyMsg={},this.isFinish=!1,this.time=3e4,this.$nextTick((function(){var t,e,o;null===(t=i.$refs)||void 0===t||null===(e=t.countDown)||void 0===e||null===(o=e.pause)||void 0===o||o.call(e)})),Object(E["nc"])(s).then((function(t){var e,o,n;console.log("send message",t),i.sendLoading[a]=!1;var s=i.chatGroupHistoryMsg.findIndex((function(t){return t.id===a}));null!==t&&void 0!==t&&t.id?i.chatGroupHistoryMsg.splice(s,1,Object(B["a"])(Object(B["a"])({},t),{},{image:t.user_image,nickname:t.user_nickname,to_msg:t.to_msg?JSON.parse(t.to_msg):""})):i.chatGroupHistoryMsg.splice(s,1),i.sendMessageLoading=!1,null===(e=i.$refs)||void 0===e||null===(o=e.countDown)||void 0===o||null===(n=o.start)||void 0===n||n.call(o),i.$store.commit("chatUserSendTimeAdd",Date.now())})).catch((function(t){console.log(t),i.sendLoading[a]=!1,i.sendError[a]=!0,i.$toast({message:t,position:"top"}),i.sendMessageLoading=!1}))}},reSendMessage:function(t){var e,o,n,i=this;null===(e=this.$refs)||void 0===e||null===(o=e.inputMessage)||void 0===o||null===(n=o.focus)||void 0===n||n.call(o);var s=t.id;this.sendLoading[s]=!0,this.sendError[s]=!1;var r={group_id:this.groupId,content:t.content,to_id:this.replyMsg.id||0,type:1};this.sendMessageLoading=!0,this.isFinish=!1,this.time=3e4,this.$nextTick((function(){var t,e,o;null===(t=i.$refs)||void 0===t||null===(e=t.countDown)||void 0===e||null===(o=e.pause)||void 0===o||o.call(e)})),Object(E["nc"])(r).then((function(t){console.log("send message",t),i.sendLoading[s]=!1;var e=i.chatGroupHistoryMsg.findIndex((function(t){return t.id===s}));null!==t&&void 0!==t&&t.id?i.chatGroupHistoryMsg.splice(e,1,Object(B["a"])(Object(B["a"])({},t),{},{image:t.user_image,nickname:t.user_nickname})):i.chatGroupHistoryMsg.splice(e,1),i.sendMessageLoading=!1,i.$refs.countDown.start(),i.$store.commit("chatUserSendTimeAdd",Date.now())})).catch((function(t){i.sendLoading[s]=!1,i.sendError[s]=!0,i.$toast({message:t,position:"top"}),i.sendMessageLoading=!1}))},scrollBottom:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=document.body.scrollHeight,o=document.documentElement.scrollTop||window.pageYOffset,n=window.innerHeight||document.documentElement.clientHeight,i=e-o;i>2*n&&!t||this.$nextTick((function(){setTimeout((function(){var t,e=document.querySelector(".scroll-bottom");null===e||void 0===e||null===(t=e.scrollIntoView)||void 0===t||t.call(e,!0)}),10)}))},handleRemove:function(t){this.chatGroupHistoryMsg.splice(t,1),this.$toast({message:this.$t("deletedSuccessfully"),position:"top"})},handleRemoveUser:function(t){this.$toast.success(this.$t("kickedSuccessfully")),this.chatGroupHistoryMsg=this.chatGroupHistoryMsg.filter((function(e){return!(e.user_address===t.user_address&&e.user_chain===t.user_chain)}))},login:function(){Object(J["a"])()},joinChatGroup:function(){var t=this;this.joinLoading=!0,Object(E["Ub"])(this.groupId).then((function(e){return e?t.$store.dispatch("getChatGroupMemberInfo",t.groupId):Promise.resolve(!1)})).then((function(e){e&&t.$toast({message:t.$t("joinGroupChatSuccessfully"),position:"top"})})).catch((function(e){t.$toast({message:e,position:"top"})})).finally((function(){t.joinLoading=!1}))},subChatMsg:function(){var t={jsonrpc:"2.0",method:"subscribe",params:["chat",this.groupId],id:1};if(this.$store.state.ws.isConnected){var e=this.$store.state.ws.chatParams;if(e[1]===t.params[1])return;(null===e||void 0===e?void 0:e.length)>0&&this.$store.commit("wsSend",{jsonrpc:"2.0",method:"unsubscribe",params:this.$store.state.ws.chatParams,id:1}),this.$store.commit("setWsState",{name:"chatParams",value:t.params}),this.$store.commit("wsSend",t)}},alertTips:function(){var t,e,o=this,n=this.$store.state.chat.groupInfo.manager_count;void 0!==n&&n<5&&0===this.role&&!this.isTip&&this.chatToken&&null!==(t=this.groupMemberInfo)&&void 0!==t&&t.group_id&&(this.isTip=!0,this.$dialog.confirm({message:this.$t("adminCountMessage",{count:5-n}),confirmButtonText:this.$t("grabbingAdmin",{n:(null===(e=this.$store.state.chat.chatConfig)||void 0===e?void 0:e.ave_chat_jf_count)||""}),cancelButtonText:this.$t("cancel"),confirmButtonColor:"#3F80F7",teleport:"#grab-dialog"}).then((function(){o.isTip=!1;var t=q["a"].get("grabAdmin",[]);t.push(o.$store.state.chat.groupId),q["a"].set("grabAdmin",t),o.$router.push({name:"ChatBurn",params:{id:o.$store.state.chat.groupId}})})).catch((function(){o.isTip=!1;var t=q["a"].get("grabAdmin",[]);t.push(o.$store.state.chat.groupId),q["a"].set("grabAdmin",t)})))},initSlowMode:function(){var t=this.$store.getters.userSendTime,e=Date.now()-t;this.isFinish=e>3e4,this.time=e<3e4?3e4-e:3e4},isShowDate:function(t,e){if(0===e)return!0;var o=this.$f.formatDate(t.created_time,"YYYY-MM-DD"),n=this.$f.formatDate(this.chatGroupHistoryMsg[e-1].created_time,"YYYY-MM-DD");return o!==n},back:function(){var t,e,o;null!==(t=this.$f.androidGlobal())&&void 0!==t&&t.back?null===(e=this.$f.androidGlobal())||void 0===e||null===(o=e.back)||void 0===o||o.call(e):window.history.state.back?this.$router.go(-1):this.$router.replace("/token/".concat(this.groupId))},saveLastMsgTime:function(t){var e=this;"Chat"===this.$route.name&&(this.TimerSaveMsgTime&&clearTimeout(this.TimerSaveMsgTime),this.TimerSaveMsgTime=setTimeout((function(){e.$store.dispatch("setChatLastMsgTime",t)}),1e3))},handleReply:function(t){this.replyMsg=t},getPinMsg:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this.groupId&&(this.getPinMsgLoading=!0,Object(E["pb"])(this.groupId,1,e).then((function(e){var o;if((null===e||void 0===e||null===(o=e.pin_msg)||void 0===o?void 0:o.length)>0){var n,i=null===e||void 0===e||null===(n=e.pin_msg)||void 0===n?void 0:n[0];t.activePinMsg=Object(B["a"])({},i),null!==i&&void 0!==i&&i.to_msg&&(t.activePinMsg.to_msg=JSON.parse(i.to_msg))}else t.activePinMsg={content:""}})).catch((function(t){console.log(t)})).finally((function(){t.getPinMsgLoading=!1})))},onModifyChatGroupHistoryMsg:function(t,e){this.chatGroupHistoryMsg.map((function(o){if(t==o.id){var n=JSON.parse(o.content),i=Object.assign(n,e);o=Object.assign(o,{content:JSON.stringify(i)})}}))},create:function(){var t=this;if("importAddress"==this.$store.state.wallet&&""==this.$store.state.provider&&window.ethereum)this.$dialog.alert({message:this.$t("connectWalletAgain"),confirmButtonText:this.$t("iKnown"),confirmButtonColor:"#3F80F7"});else{var e=Z["a"].findIndex((function(e){var o;return e==(null===(o=t.$store.state.chat)||void 0===o?void 0:o.userInfo.chain)}));-1!=e?this.$router.push({path:"/chat/".concat(this.groupId,"/redCreate"),query:{total:this.total}}):this.$toast(this.$t("tipSwitchChain",{chain:"BSC"}))}}}};o("ad0a");const et=U()(tt,[["render",V],["__scopeId","data-v-59f8c2ef"]]);e["default"]=et},a5b8:function(t,e,o){"use strict";o("fba5")},ad0a:function(t,e,o){"use strict";o("d4ad")},c8d2:function(t,e,o){var n=o("5e77").PROPER,i=o("d039"),s=o("5899"),r="​᠎";t.exports=function(t){return i((function(){return!!s[t]()||r[t]()!==r||n&&s[t].name!==t}))}},d4ad:function(t,e,o){},fba5:function(t,e,o){}}]);